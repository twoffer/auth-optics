/**
 * Vulnerability Mode Configuration Types
 *
 * Defines all 39 vulnerability toggles for educational purposes.
 * MVP: Only DISABLE_PKCE is functional
 * Phase 2-3: Additional toggles will be implemented
 *
 * @module vulnerability/vulnerability-config
 */

/**
 * Vulnerability Mode Configuration
 *
 * Top-level configuration for vulnerability mode with safety controls.
 *
 * @example
 * ```typescript
 * const config: VulnerabilityConfig = {
 *   enabled: false,
 *   toggles: SECURE_DEFAULTS,
 *   lastModified: '2024-01-06T10:00:00Z',
 *   warningAcknowledged: false
 * };
 * ```
 */
export interface VulnerabilityConfig {
  /**
   * Whether vulnerability mode is globally enabled
   *
   * Even if individual toggles are enabled, vulnerability mode must be
   * globally enabled for them to take effect.
   *
   * Default: false (secure)
   */
  enabled: boolean;

  /**
   * Individual vulnerability toggles
   *
   * Each toggle corresponds to a specific vulnerability.
   * Default: All false (secure)
   */
  toggles: VulnerabilityToggles;

  /**
   * Timestamp of last modification (ISO 8601)
   *
   * Tracks when configuration was last changed
   */
  lastModified: string;

  /**
   * Whether user has acknowledged vulnerability warning
   *
   * UI MUST display warning when enabling vulnerability mode
   * User must explicitly acknowledge before proceeding
   *
   * Default: false
   */
  warningAcknowledged: boolean;
}

/**
 * All Vulnerability Toggles
 *
 * Comprehensive set of 39 vulnerability toggles for educational purposes.
 *
 * MVP: Only DISABLE_PKCE is functional
 * Phase 2: Additional toggles will be implemented
 * Phase 3: Remaining toggles
 *
 * All toggles default to false (secure).
 * Setting a toggle to true enables that vulnerability.
 */
export interface VulnerabilityToggles {
  // ========================================================================
  // MVP TOGGLES (1 toggle - functional in MVP)
  // ========================================================================

  /**
   * DISABLE_PKCE - Disable Proof Key for Code Exchange
   *
   * RFC 7636: PKCE prevents authorization code interception attacks
   * OAuth 2.1: PKCE is REQUIRED for all authorization code flows
   *
   * When enabled (vulnerability active):
   * - No code_challenge sent in authorization request
   * - No code_verifier sent in token request
   * - Authorization code can be intercepted and used
   *
   * Attack: Authorization Code Interception (RFC 6819 Section 4.4.1.1)
   * Severity: CRITICAL
   * Category: AUTHORIZATION_ENDPOINT
   *
   * Educational value: Demonstrates why PKCE is critical for public clients
   *
   * Default: false (PKCE enabled, secure)
   */
  DISABLE_PKCE: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - State/CSRF (3 toggles)
  // ========================================================================

  /**
   * DISABLE_STATE - Disable state parameter
   *
   * RFC 6749 Section 10.12: State parameter prevents CSRF attacks
   * OAuth 2.1: State is REQUIRED for all flows
   *
   * When enabled:
   * - No state parameter in authorization request
   * - CSRF attacks become possible
   *
   * Attack: Cross-Site Request Forgery
   * Severity: CRITICAL
   * Category: STATE_CSRF
   *
   * Default: false (state enabled, secure)
   */
  DISABLE_STATE: boolean;

  /**
   * PREDICTABLE_STATE - Use predictable state values
   *
   * Security BCP: State MUST be cryptographically random
   *
   * When enabled:
   * - State uses predictable/sequential values
   * - Attacker can guess state values
   *
   * Attack: State prediction attack
   * Severity: HIGH
   * Category: STATE_CSRF
   *
   * Default: false (random state, secure)
   */
  PREDICTABLE_STATE: boolean;

  /**
   * SKIP_STATE_VERIFICATION - Skip state validation in callback
   *
   * RFC 6749 Section 10.12: State MUST be verified
   *
   * When enabled:
   * - State parameter not validated in callback
   * - CSRF protection ineffective
   *
   * Attack: CSRF bypass
   * Severity: CRITICAL
   * Category: STATE_CSRF
   *
   * Default: false (state verified, secure)
   */
  SKIP_STATE_VERIFICATION: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Nonce (3 toggles)
  // ========================================================================

  /**
   * DISABLE_NONCE - Disable nonce parameter (OIDC)
   *
   * OIDC Core Section 3.1.2.1: Nonce prevents ID token replay
   *
   * When enabled:
   * - No nonce in authorization request
   * - ID token replay attacks possible
   *
   * Attack: ID token replay
   * Severity: HIGH
   * Category: TOKEN_VALIDATION
   *
   * Default: false (nonce enabled, secure)
   */
  DISABLE_NONCE: boolean;

  /**
   * PREDICTABLE_NONCE - Use predictable nonce values
   *
   * When enabled:
   * - Nonce uses predictable values
   * - Attacker can guess nonce
   *
   * Attack: Nonce prediction attack
   * Severity: MEDIUM
   * Category: TOKEN_VALIDATION
   *
   * Default: false (random nonce, secure)
   */
  PREDICTABLE_NONCE: boolean;

  /**
   * SKIP_NONCE_VERIFICATION - Skip nonce validation in ID token
   *
   * OIDC Core Section 3.1.3.7: Nonce MUST be verified
   *
   * When enabled:
   * - Nonce not validated in ID token
   * - ID token replay protection ineffective
   *
   * Attack: ID token replay bypass
   * Severity: HIGH
   * Category: TOKEN_VALIDATION
   *
   * Default: false (nonce verified, secure)
   */
  SKIP_NONCE_VERIFICATION: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Redirect URI (3 toggles)
  // ========================================================================

  /**
   * LAX_REDIRECT_URI - Use lax redirect URI matching
   *
   * Security BCP Section 4.1: Exact URI matching required
   *
   * When enabled:
   * - Substring matching allowed
   * - Partial URL matches accepted
   *
   * Attack: Redirect URI manipulation
   * Severity: HIGH
   * Category: REDIRECT_URI
   *
   * Default: false (exact matching, secure)
   */
  LAX_REDIRECT_URI: boolean;

  /**
   * ALLOW_OPEN_REDIRECT - Allow open redirect vulnerabilities
   *
   * RFC 6749 Section 10.6: Redirect URI MUST be validated
   *
   * When enabled:
   * - Any redirect URI accepted
   * - Authorization code sent to attacker
   *
   * Attack: Open redirect attack
   * Severity: CRITICAL
   * Category: REDIRECT_URI
   *
   * Default: false (validated URIs only, secure)
   */
  ALLOW_OPEN_REDIRECT: boolean;

  /**
   * PATTERN_MATCHING_URI - Use pattern-based URI matching
   *
   * Security BCP: Exact matching preferred
   *
   * When enabled:
   * - Wildcards in redirect URIs
   * - Pattern-based matching
   *
   * Attack: URI pattern exploitation
   * Severity: MEDIUM
   * Category: REDIRECT_URI
   *
   * Default: false (exact matching, secure)
   */
  PATTERN_MATCHING_URI: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Token Validation (6 toggles)
  // ========================================================================

  /**
   * SKIP_SIGNATURE_VERIFICATION - Skip JWT signature verification
   *
   * RFC 7519 Section 7.2: Signature MUST be verified
   *
   * When enabled:
   * - JWT signatures not verified
   * - Forged tokens accepted
   *
   * Attack: Token forgery
   * Severity: CRITICAL
   * Category: TOKEN_VALIDATION
   *
   * Default: false (signatures verified, secure)
   */
  SKIP_SIGNATURE_VERIFICATION: boolean;

  /**
   * SKIP_EXPIRATION_CHECK - Skip token expiration validation
   *
   * RFC 7519 Section 4.1.4: exp claim MUST be validated
   *
   * When enabled:
   * - Expired tokens accepted
   * - Token lifetime unlimited
   *
   * Attack: Expired token reuse
   * Severity: HIGH
   * Category: TOKEN_VALIDATION
   *
   * Default: false (expiration checked, secure)
   */
  SKIP_EXPIRATION_CHECK: boolean;

  /**
   * SKIP_ISSUER_VALIDATION - Skip issuer (iss) validation
   *
   * RFC 7519 Section 4.1.1: iss claim should be validated
   *
   * When enabled:
   * - Issuer not validated
   * - Tokens from wrong issuer accepted
   *
   * Attack: Token substitution
   * Severity: HIGH
   * Category: TOKEN_VALIDATION
   *
   * Default: false (issuer validated, secure)
   */
  SKIP_ISSUER_VALIDATION: boolean;

  /**
   * SKIP_AUDIENCE_VALIDATION - Skip audience (aud) validation
   *
   * RFC 7519 Section 4.1.3: aud claim should be validated
   *
   * When enabled:
   * - Audience not validated
   * - Tokens for other audiences accepted
   *
   * Attack: Token reuse across services
   * Severity: MEDIUM
   * Category: TOKEN_VALIDATION
   *
   * Default: false (audience validated, secure)
   */
  SKIP_AUDIENCE_VALIDATION: boolean;

  /**
   * SKIP_AT_HASH - Skip at_hash validation (OIDC)
   *
   * OIDC Core Section 3.1.3.7: at_hash prevents token substitution
   *
   * When enabled:
   * - at_hash claim not validated
   * - Access token substitution possible
   *
   * Attack: Access token substitution
   * Severity: MEDIUM
   * Category: TOKEN_VALIDATION
   *
   * Default: false (at_hash validated, secure)
   */
  SKIP_AT_HASH: boolean;

  /**
   * SKIP_C_HASH - Skip c_hash validation (OIDC)
   *
   * OIDC Core Section 3.1.3.7: c_hash prevents code substitution
   *
   * When enabled:
   * - c_hash claim not validated
   * - Authorization code substitution possible
   *
   * Attack: Authorization code substitution
   * Severity: MEDIUM
   * Category: TOKEN_VALIDATION
   *
   * Default: false (c_hash validated, secure)
   */
  SKIP_C_HASH: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Token Binding (3 toggles)
  // ========================================================================

  /**
   * DISABLE_DPOP - Disable DPoP (Demonstrating Proof of Possession)
   *
   * RFC 9449: DPoP prevents token theft
   *
   * When enabled:
   * - No DPoP proof required
   * - Tokens not sender-constrained
   *
   * Attack: Bearer token theft
   * Severity: HIGH
   * Category: TOKEN_BINDING
   *
   * Default: false (DPoP enabled, secure)
   */
  DISABLE_DPOP: boolean;

  /**
   * ALLOW_TOKEN_REUSE - Allow bearer token reuse
   *
   * When enabled:
   * - Tokens can be used from any origin
   * - No binding to client
   *
   * Attack: Token theft and replay
   * Severity: HIGH
   * Category: TOKEN_BINDING
   *
   * Default: false (token binding enforced, secure)
   */
  ALLOW_TOKEN_REUSE: boolean;

  /**
   * DISABLE_MTLS - Disable Mutual TLS
   *
   * RFC 8705: mTLS binds tokens to client certificate
   *
   * When enabled:
   * - No client certificate required
   * - Tokens not bound to certificate
   *
   * Attack: Token theft
   * Severity: MEDIUM
   * Category: TOKEN_BINDING
   *
   * Default: false (mTLS enabled, secure)
   */
  DISABLE_MTLS: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Client Authentication (3 toggles)
  // ========================================================================

  /**
   * SKIP_CLIENT_AUTH - Skip client authentication
   *
   * RFC 6749 Section 2.3: Confidential clients MUST authenticate
   *
   * When enabled:
   * - Client authentication not required
   * - Anyone can request tokens
   *
   * Attack: Client impersonation
   * Severity: CRITICAL
   * Category: CLIENT_AUTHENTICATION
   *
   * Default: false (client auth required, secure)
   */
  SKIP_CLIENT_AUTH: boolean;

  /**
   * WEAK_CLIENT_SECRET - Use weak client secret
   *
   * When enabled:
   * - Client secret is predictable/weak
   * - Attacker can guess secret
   *
   * Attack: Client secret guessing
   * Severity: HIGH
   * Category: CLIENT_AUTHENTICATION
   *
   * Default: false (strong secrets, secure)
   */
  WEAK_CLIENT_SECRET: boolean;

  /**
   * CLIENT_SECRET_IN_QUERY - Send client secret in query parameters
   *
   * Security BCP: Client secrets MUST NOT be in URLs
   *
   * When enabled:
   * - Client secret in query string
   * - Secret logged and cached
   *
   * Attack: Secret leakage via logs
   * Severity: HIGH
   * Category: CLIENT_AUTHENTICATION
   *
   * Default: false (secret in body, secure)
   */
  CLIENT_SECRET_IN_QUERY: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Scope Handling (2 toggles)
  // ========================================================================

  /**
   * SKIP_SCOPE_VALIDATION - Skip scope validation
   *
   * RFC 6749 Section 3.3: Scopes define access rights
   *
   * When enabled:
   * - Requested scopes not validated
   * - Any scope accepted
   *
   * Attack: Unauthorized scope access
   * Severity: MEDIUM
   * Category: SCOPE_HANDLING
   *
   * Default: false (scopes validated, secure)
   */
  SKIP_SCOPE_VALIDATION: boolean;

  /**
   * ALLOW_SCOPE_ESCALATION - Allow scope escalation
   *
   * When enabled:
   * - More scopes returned than requested
   * - Client gets unauthorized permissions
   *
   * Attack: Privilege escalation
   * Severity: HIGH
   * Category: SCOPE_HANDLING
   *
   * Default: false (no escalation, secure)
   */
  ALLOW_SCOPE_ESCALATION: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Refresh Tokens (3 toggles)
  // ========================================================================

  /**
   * DISABLE_REFRESH_ROTATION - Disable refresh token rotation
   *
   * Security BCP Section 4.13: Refresh tokens SHOULD rotate
   *
   * When enabled:
   * - Same refresh token reused
   * - Token theft harder to detect
   *
   * Attack: Refresh token theft
   * Severity: MEDIUM
   * Category: REFRESH_TOKEN
   *
   * Default: false (rotation enabled, secure)
   */
  DISABLE_REFRESH_ROTATION: boolean;

  /**
   * REUSABLE_REFRESH - Allow refresh token reuse
   *
   * Security BCP: Refresh tokens SHOULD be single-use
   *
   * When enabled:
   * - Refresh token reusable
   * - Multiple token issuances possible
   *
   * Attack: Refresh token replay
   * Severity: HIGH
   * Category: REFRESH_TOKEN
   *
   * Default: false (single-use, secure)
   */
  REUSABLE_REFRESH: boolean;

  /**
   * SKIP_REFRESH_BINDING - Skip refresh token binding
   *
   * When enabled:
   * - Refresh token not bound to client
   * - Token usable from anywhere
   *
   * Attack: Refresh token theft
   * Severity: MEDIUM
   * Category: REFRESH_TOKEN
   *
   * Default: false (binding enforced, secure)
   */
  SKIP_REFRESH_BINDING: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Transport Security (2 toggles)
  // ========================================================================

  /**
   * ALLOW_HTTP - Allow HTTP instead of HTTPS
   *
   * RFC 6749 Section 3.1: HTTPS REQUIRED for all endpoints
   *
   * When enabled:
   * - HTTP endpoints accepted
   * - Credentials sent in cleartext
   *
   * Attack: Man-in-the-middle
   * Severity: CRITICAL
   * Category: TRANSPORT_SECURITY
   *
   * Default: false (HTTPS required, secure)
   */
  ALLOW_HTTP: boolean;

  /**
   * SKIP_CERT_VALIDATION - Skip TLS certificate validation
   *
   * When enabled:
   * - Invalid/self-signed certificates accepted
   * - MITM attacks possible
   *
   * Attack: Certificate spoofing
   * Severity: CRITICAL
   * Category: TRANSPORT_SECURITY
   *
   * Default: false (certificates validated, secure)
   */
  SKIP_CERT_VALIDATION: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Token Leakage (3 toggles)
  // ========================================================================

  /**
   * ALLOW_FRAGMENT_TOKENS - Allow tokens in URL fragments
   *
   * Security BCP Section 4.2.4: Avoid tokens in URLs
   *
   * When enabled:
   * - Tokens in URL fragments (Implicit Flow)
   * - Token leakage via Referer header
   *
   * Attack: Token leakage
   * Severity: HIGH
   * Category: TOKEN_LEAKAGE
   *
   * Default: false (no fragment tokens, secure)
   */
  ALLOW_FRAGMENT_TOKENS: boolean;

  /**
   * ALLOW_TOKENS_IN_HISTORY - Allow tokens in browser history
   *
   * When enabled:
   * - Tokens stored in browser history
   * - Tokens accessible from history
   *
   * Attack: Token leakage via history
   * Severity: MEDIUM
   * Category: TOKEN_LEAKAGE
   *
   * Default: false (no history storage, secure)
   */
  ALLOW_TOKENS_IN_HISTORY: boolean;

  /**
   * DISABLE_TOKEN_ENCRYPTION - Disable token encryption at rest
   *
   * When enabled:
   * - Tokens stored in plaintext
   * - Tokens readable from storage
   *
   * Attack: Token theft from storage
   * Severity: MEDIUM
   * Category: TOKEN_LEAKAGE
   *
   * Default: false (encryption enabled, secure)
   */
  DISABLE_TOKEN_ENCRYPTION: boolean;

  // ========================================================================
  // PHASE 2 TOGGLES - Authorization Code (3 toggles)
  // ========================================================================

  /**
   * ALLOW_CODE_REUSE - Allow authorization code reuse
   *
   * RFC 6749 Section 4.1.2: Codes MUST be single-use
   *
   * When enabled:
   * - Authorization codes reusable
   * - Multiple token requests possible
   *
   * Attack: Code replay
   * Severity: HIGH
   * Category: AUTHORIZATION_ENDPOINT
   *
   * Default: false (single-use codes, secure)
   */
  ALLOW_CODE_REUSE: boolean;

  /**
   * PREDICTABLE_AUTH_CODE - Use predictable authorization codes
   *
   * When enabled:
   * - Authorization codes predictable
   * - Attacker can guess codes
   *
   * Attack: Code guessing
   * Severity: HIGH
   * Category: AUTHORIZATION_ENDPOINT
   *
   * Default: false (random codes, secure)
   */
  PREDICTABLE_AUTH_CODE: boolean;

  /**
   * EXTENDED_CODE_LIFETIME - Extend authorization code lifetime
   *
   * RFC 6749 Section 4.1.2: Codes SHOULD be short-lived (10 min max)
   *
   * When enabled:
   * - Codes valid for extended period
   * - Increased window for attacks
   *
   * Attack: Extended attack window
   * Severity: MEDIUM
   * Category: AUTHORIZATION_ENDPOINT
   *
   * Default: false (short lifetime, secure)
   */
  EXTENDED_CODE_LIFETIME: boolean;

  // ========================================================================
  // PHASE 3 TOGGLES - UI/UX Security (3 toggles)
  // ========================================================================

  /**
   * ALLOW_IFRAME - Allow authorization in iframes
   *
   * RFC 6749 Section 10.13: Prevent clickjacking
   *
   * When enabled:
   * - Authorization page in iframe
   * - Clickjacking attacks possible
   *
   * Attack: Clickjacking
   * Severity: MEDIUM
   * Category: UI_UX_SECURITY
   *
   * Default: false (iframe blocked, secure)
   */
  ALLOW_IFRAME: boolean;

  /**
   * DISABLE_CORS - Disable CORS protection
   *
   * When enabled:
   * - CORS headers disabled
   * - Cross-origin attacks possible
   *
   * Attack: CORS bypass
   * Severity: MEDIUM
   * Category: UI_UX_SECURITY
   *
   * Default: false (CORS enabled, secure)
   */
  DISABLE_CORS: boolean;

  /**
   * ALLOW_MIXED_CONTENT - Allow mixed HTTP/HTTPS content
   *
   * When enabled:
   * - HTTP resources on HTTPS pages
   * - Downgrade attacks possible
   *
   * Attack: Mixed content exploitation
   * Severity: MEDIUM
   * Category: UI_UX_SECURITY
   *
   * Default: false (no mixed content, secure)
   */
  ALLOW_MIXED_CONTENT: boolean;
}

/**
 * Secure Default Configuration
 *
 * All vulnerability toggles disabled (secure configuration).
 * This is the default state for production use.
 */
export const SECURE_DEFAULTS: VulnerabilityToggles = {
  // MVP
  DISABLE_PKCE: false,

  // Phase 2 - State/CSRF
  DISABLE_STATE: false,
  PREDICTABLE_STATE: false,
  SKIP_STATE_VERIFICATION: false,

  // Phase 2 - Nonce
  DISABLE_NONCE: false,
  PREDICTABLE_NONCE: false,
  SKIP_NONCE_VERIFICATION: false,

  // Phase 2 - Redirect URI
  LAX_REDIRECT_URI: false,
  ALLOW_OPEN_REDIRECT: false,
  PATTERN_MATCHING_URI: false,

  // Phase 2 - Token Validation
  SKIP_SIGNATURE_VERIFICATION: false,
  SKIP_EXPIRATION_CHECK: false,
  SKIP_ISSUER_VALIDATION: false,
  SKIP_AUDIENCE_VALIDATION: false,
  SKIP_AT_HASH: false,
  SKIP_C_HASH: false,

  // Phase 2 - Token Binding
  DISABLE_DPOP: false,
  ALLOW_TOKEN_REUSE: false,
  DISABLE_MTLS: false,

  // Phase 2 - Client Authentication
  SKIP_CLIENT_AUTH: false,
  WEAK_CLIENT_SECRET: false,
  CLIENT_SECRET_IN_QUERY: false,

  // Phase 2 - Scope Handling
  SKIP_SCOPE_VALIDATION: false,
  ALLOW_SCOPE_ESCALATION: false,

  // Phase 2 - Refresh Tokens
  DISABLE_REFRESH_ROTATION: false,
  REUSABLE_REFRESH: false,
  SKIP_REFRESH_BINDING: false,

  // Phase 2 - Transport Security
  ALLOW_HTTP: false,
  SKIP_CERT_VALIDATION: false,

  // Phase 2 - Token Leakage
  ALLOW_FRAGMENT_TOKENS: false,
  ALLOW_TOKENS_IN_HISTORY: false,
  DISABLE_TOKEN_ENCRYPTION: false,

  // Phase 2 - Authorization Code
  ALLOW_CODE_REUSE: false,
  PREDICTABLE_AUTH_CODE: false,
  EXTENDED_CODE_LIFETIME: false,

  // Phase 3 - UI/UX Security
  ALLOW_IFRAME: false,
  DISABLE_CORS: false,
  ALLOW_MIXED_CONTENT: false,
};
