# Vulnerability Mode Reference - Overview
## Educational Security Demonstration System

> *"Security is better taught by breaking things intentionally than by hoping they never break accidentally."*

---

## Document Information

| Property | Value |
|----------|-------|
| **Document Type** | Implementation Reference |
| **Target Audience** | Tool developers, security educators, security professionals |
| **Purpose** | Comprehensive guide to vulnerability toggle system |
| **Related Docs** | `oauth2-oidc-threat-model.md`, all security implementation guides |

---

## 1. Overview

### 1.1 Purpose

**Vulnerability Mode** provides educational demonstrations of OAuth2/OIDC security vulnerabilities through an interactive toggle system. Each toggle intentionally disables a specific security control, allowing users to observe and understand real attack scenarios.

**Key Principles**:
- **Educational Only**: Not for production use under any circumstances
- **Intentional Vulnerabilities**: All weaknesses are deliberate
- **Safe Environment**: Attacks demonstrated against localhost test servers
- **Comparative Learning**: Show both vulnerable and secure configurations

### 1.2 Audience

**Primary Users**:
- Security professionals learning OAuth2/OIDC
- Developers implementing OAuth2/OIDC clients
- Security auditors understanding attack vectors
- Educators teaching authentication security
- Penetration testers studying OAuth2/OIDC exploits

### 1.3 Goals

1. **Demonstrate Attacks**: Show how vulnerabilities are exploited
2. **Teach Mitigation**: Explain how to prevent attacks
3. **Build Intuition**: Help users understand "why" behind security requirements
4. **Reference Specs**: Connect demonstrations to RFC/BCP sections
5. **Safe Experimentation**: Provide playground for security exploration

### 1.4 Ethical Use Statement

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ETHICAL USE REQUIREMENTS                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘  This vulnerability mode is for EDUCATIONAL PURPOSES      â•‘
â•‘  ONLY. Use of these techniques against systems you do     â•‘
â•‘  not own or have explicit permission to test is:         â•‘
â•‘                                                           â•‘
â•‘  â€¢ ILLEGAL in most jurisdictions                         â•‘
â•‘  â€¢ UNETHICAL                                              â•‘
â•‘  â€¢ A VIOLATION of computer fraud laws                    â•‘
â•‘                                                           â•‘
â•‘  Acceptable Use:                                         â•‘
â•‘  âœ“ Learning and education                                â•‘
â•‘  âœ“ Testing your own applications                         â•‘
â•‘  âœ“ Authorized security assessments                       â•‘
â•‘  âœ“ Classroom demonstrations                              â•‘
â•‘                                                           â•‘
â•‘  You are responsible for your use of this software.      â•‘
â•‘                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 2. Vulnerability Mode Architecture

### 2.1 Toggle-Based System

**Core Concept**: Individual on/off switches for specific security controls

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vulnerability Mode Control Panel                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Authorization Endpoint                                 â”‚
â”‚  [âœ“] DISABLE_PKCE              Code interception        â”‚
â”‚  [ ] SKIP_STATE_VALIDATION     CSRF attacks             â”‚
â”‚  [ ] LAX_REDIRECT_URI          Open redirect            â”‚
â”‚                                                          â”‚
â”‚  Token Validation                                       â”‚
â”‚  [ ] SKIP_JWT_VERIFICATION     Bypass signature         â”‚
â”‚  [ ] ACCEPT_NONE_ALGORITHM     Critical vulnerability   â”‚
â”‚  [ ] SKIP_EXPIRATION_CHECK     Use expired tokens       â”‚
â”‚                                                          â”‚
â”‚  [Enable All]  [Disable All]  [Reset to Secure]        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features**:
- Independent toggles for each vulnerability
- Multiple vulnerabilities can be active simultaneously
- Clear indication of active vulnerabilities
- Easy reset to secure defaults

### 2.2 Implementation Approaches

#### Approach 1: Configuration-Based (Recommended)

**Method**: Pass configuration flags to OAuth2/OIDC client

```javascript
const client = new OAuth2Client({
  clientId: 'web-app',
  authorizationEndpoint: 'http://localhost:8080/...',
  
  // Vulnerability configuration
  vulnerabilities: {
    DISABLE_PKCE: true,
    SKIP_STATE_VALIDATION: false,
    ACCEPT_NONE_ALGORITHM: false,
    // ... other toggles
  }
});
```

**Advantages**:
- Works with any identity provider
- Full control over client behavior
- Easy to implement in tool

#### Approach 2: Server-Based (Alternative)

**Method**: Connect to KeyCloak's `vulnerable-client` configuration

**Advantages**:
- Server-side configuration demonstrates real IdP misconfigurations
- More realistic for certain vulnerabilities

**Disadvantages**:
- Limited to KeyCloak-supported vulnerabilities
- Requires server changes for each demonstration

**Recommendation**: Use Approach 1 (configuration-based) for flexibility

### 2.3 Warning System

**Components**:

1. **Global Warning Banner** (when any vulnerability active)
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  VULNERABILITY MODE ACTIVE  âš ï¸                        â•‘
â•‘  2 vulnerabilities enabled. Security protections         â•‘
â•‘  intentionally disabled for educational purposes.        â•‘
â•‘  [View Details] [Reset to Secure]                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

2. **Per-Vulnerability Warnings**
```
âš ï¸ PKCE DISABLED
Authorization codes can be intercepted and used by attackers.
[Why is this dangerous?] [How to fix] [Learn more]
```

3. **Flow-Specific Warnings**
```
You are about to execute an authorization code flow WITHOUT PKCE.
This is vulnerable to code interception attacks.

Continue? [Yes, demonstrate attack] [No, enable PKCE]
```

4. **Reset Prompts**
```
Before proceeding to production implementation:
â˜ All vulnerability toggles disabled
â˜ PKCE enabled
â˜ State validation enabled
â˜ Proper redirect URI validation
â˜ Token signature verification active

[Verify Security Checklist]
```

---

## 3. Vulnerability Toggle Naming Convention

### 3.1 Naming Format

**Pattern**: `CATEGORY_SPECIFIC_DESCRIPTION`

**Rules**:
- ALL_CAPS for consistency
- Descriptive of what's disabled/weakened
- Clear indication of security control affected

### 3.2 Categories

| Category | Description | Example Toggles |
|----------|-------------|-----------------|
| **Authorization Endpoint** | Vulnerabilities in authorization request/response | `DISABLE_PKCE`, `SKIP_STATE_VALIDATION` |
| **Token Endpoint** | Token exchange and refresh vulnerabilities | `SKIP_CLIENT_AUTH`, `REUSABLE_AUTH_CODE` |
| **Token Validation** | JWT verification and claim validation | `SKIP_JWT_VERIFICATION`, `ACCEPT_NONE_ALGORITHM` |
| **Token Storage** | Storage of tokens in client | `LOCALSTORAGE_TOKENS`, `INSECURE_REFRESH_STORAGE` |
| **Token Transmission** | How tokens are transmitted | `ALLOW_TOKEN_IN_URL`, `HTTP_RESOURCE_SERVER` |
| **Refresh Token** | Refresh token specific vulnerabilities | `REUSABLE_REFRESH_TOKENS`, `INFINITE_REFRESH_LIFETIME` |
| **Flow-Specific** | Deprecated or dangerous flows | `IMPLICIT_FLOW`, `PASSWORD_GRANT` |
| **Other** | Miscellaneous vulnerabilities | `NO_RATE_LIMITING`, `SKIP_CERT_VALIDATION` |

### 3.3 Toggle State Semantics

**When Toggle is ENABLED**: Vulnerability is ACTIVE (security control disabled)
**When Toggle is DISABLED**: Secure behavior (security control active)

**Example**:
- `DISABLE_PKCE = true` â†’ PKCE is disabled (vulnerable)
- `DISABLE_PKCE = false` â†’ PKCE is active (secure)

---

## 4. Master Vulnerability Toggle List

### 4.1 Complete Toggle Inventory

| Toggle Name | Category | Attack Demonstrated | Severity | Spec Reference | Related Docs |
|-------------|----------|---------------------|----------|----------------|--------------|
| `DISABLE_PKCE` | Authorization | Code Interception | ğŸ”´ Critical | RFC 7636, BCP Â§4.8 | `pkce-implementation.md` |
| `SKIP_STATE_VALIDATION` | Authorization | CSRF | ğŸ”´ Critical | RFC 6749 Â§10.12, BCP Â§4.7 | `state-parameter-and-csrf.md` |
| `PREDICTABLE_STATE` | Authorization | CSRF (weak state) | ğŸŸ  High | BCP Â§4.7.1 | `state-parameter-and-csrf.md` |
| `LAX_REDIRECT_URI` | Authorization | Open Redirect | ğŸ”´ Critical | RFC 6749 Â§3.1.2, BCP Â§4.1 | `redirect-uri-validation.md` |
| `PATTERN_MATCHING_URI` | Authorization | Redirect URI Bypass | ğŸŸ  High | BCP Â§4.1.2 | `redirect-uri-validation.md` |
| `ALLOW_IFRAME` | Authorization | Clickjacking | ğŸŸ¡ Medium | RFC 6749 Â§10.13 | `security-best-current-practice.md` |
| `HTTP_AUTHORIZATION_ENDPOINT` | Authorization | Network Interception | ğŸ”´ Critical | BCP Â§4.2 | `security-best-current-practice.md` |
| `DISABLE_ISS_CHECK` | Authorization | Mix-Up Attack | ğŸ”´ Critical | RFC 9207, BCP Â§4.4 | `oauth2-oidc-threat-model.md` |
| `PKCE_DOWNGRADE` | Authorization | PKCE Downgrade | ğŸŸ  High | BCP Â§4.8.2 | `pkce-implementation.md` |
| `SKIP_CLIENT_AUTH` | Token | Client Impersonation | ğŸ”´ Critical | RFC 6749 Â§3.2.1 | `client-credentials-flow.md` |
| `WEAK_CLIENT_SECRET` | Token | Secret Compromise | ğŸŸ  High | BCP Â§4.14 | `security-best-current-practice.md` |
| `REUSABLE_AUTH_CODE` | Token | Code Replay | ğŸ”´ Critical | RFC 6749 Â§4.1.2 | `authorization-code-flow-with-pkce.md` |
| `ALLOW_SCOPE_ESCALATION` | Token | Privilege Escalation | ğŸŸ  High | RFC 6749 Â§5.1 | `security-best-current-practice.md` |
| `HTTP_TOKEN_ENDPOINT` | Token | Network Interception | ğŸ”´ Critical | BCP Â§4.2 | `security-best-current-practice.md` |
| `SKIP_JWT_VERIFICATION` | Validation | Signature Bypass | ğŸ”´ Critical | RFC 7515 | `jwt-structure-and-validation.md` |
| `ACCEPT_NONE_ALGORITHM` | Validation | alg=none Bypass | ğŸ”´ Critical | RFC 7515 Â§8.1 | `jwt-structure-and-validation.md` |
| `FLEXIBLE_JWT_ALGORITHM` | Validation | Algorithm Confusion | ğŸ”´ Critical | RFC 7515 Â§8.2 | `jwt-structure-and-validation.md` |
| `SKIP_EXPIRATION_CHECK` | Validation | Expired Token Use | ğŸŸ  High | RFC 7519 Â§4.1.4 | `jwt-structure-and-validation.md` |
| `SKIP_AUD_CHECK` | Validation | Token Misuse | ğŸŸ  High | RFC 7519 Â§4.1.3 | `jwt-structure-and-validation.md` |
| `SKIP_ISS_CHECK` | Validation | Token Substitution | ğŸ”´ Critical | RFC 7519 Â§4.1.1 | `jwt-structure-and-validation.md` |
| `SKIP_NONCE` | Validation | ID Token Replay | ğŸŸ  High | OIDC Core Â§3.1.3.7 | `id-tokens-oidc.md` |
| `SKIP_AT_HASH` | Validation | Access Token Injection | ğŸŸ  High | OIDC Core Â§3.1.3.7 | `id-tokens-oidc.md` |
| `SKIP_HASH_VALIDATION` | Validation | Token Substitution | ğŸŸ  High | OIDC Core Â§3.1.3.7 | `id-tokens-oidc.md` |
| `LOCALSTORAGE_TOKENS` | Storage | XSS Token Theft | ğŸ”´ Critical | BCP Â§4.3.3 | `security-best-current-practice.md` |
| `INSECURE_REFRESH_STORAGE` | Storage | Refresh Token Theft | ğŸŸ  High | BCP Â§4.13 | `refresh-tokens.md` |
| `ALLOW_TOKEN_EXPORT` | Storage | Token Leakage | ğŸŸ¡ Medium | BCP | `security-best-current-practice.md` |
| `ALLOW_TOKEN_IN_URL` | Transmission | URL Token Leakage | ğŸ”´ Critical | BCP Â§4.2.4 | `security-best-current-practice.md` |
| `HTTP_RESOURCE_SERVER` | Transmission | Network Interception | ğŸ”´ Critical | BCP Â§4.2 | `security-best-current-practice.md` |
| `ALLOW_FRAGMENT_TOKENS` | Transmission | History Token Leakage | ğŸŸ  High | BCP Â§2.1.2 | `deprecated-implicit-flow.md` |
| `REUSABLE_REFRESH_TOKENS` | Refresh Token | Token Replay | ğŸŸ  High | BCP Â§4.13.2 | `refresh-tokens.md` |
| `INFINITE_REFRESH_LIFETIME` | Refresh Token | Indefinite Access | ğŸŸ¡ Medium | BCP Â§4.13.1 | `refresh-tokens.md` |
| `SKIP_REFRESH_ROTATION` | Refresh Token | No Token Rotation | ğŸŸ  High | BCP Â§4.13.2 | `refresh-tokens.md` |
| `IMPLICIT_FLOW` | Flow-Specific | Implicit Flow Vulns | ğŸ”´ Critical | BCP Â§2.1.2 | `deprecated-implicit-flow.md` |
| `PASSWORD_GRANT` | Flow-Specific | Credential Exposure | ğŸ”´ Critical | BCP Â§2.4 | `deprecated-resource-owner-password-flow.md` |
| `LOG_CREDENTIALS` | Flow-Specific | Credential Logging | ğŸ”´ Critical | BCP | Security practices |
| `NO_RATE_LIMITING` | Other | Brute Force | ğŸŸ¡ Medium | BCP | `security-best-current-practice.md` |
| `SKIP_CERT_VALIDATION` | Other | MITM | ğŸ”´ Critical | BCP | `security-best-current-practice.md` |
| `CLIENT_OPEN_REDIRECT` | Other | Phishing | ğŸŸ  High | BCP Â§4.1.3 | `redirect-uri-validation.md` |
| `VERBOSE_ERROR_MESSAGES` | Other | Information Disclosure | ğŸŸ¡ Medium | BCP | `security-best-current-practice.md` |

**Severity Legend**:
- ğŸ”´ **Critical**: Complete security bypass, immediate exploitation
- ğŸŸ  **High**: Significant security impact, exploitation likely
- ğŸŸ¡ **Medium**: Security degradation, exploitation possible under conditions

### 4.2 Toggle Count by Category

| Category | Count | Most Critical |
|----------|-------|---------------|
| Authorization Endpoint | 9 | `DISABLE_PKCE`, `SKIP_STATE_VALIDATION`, `LAX_REDIRECT_URI` |
| Token Endpoint | 5 | `SKIP_CLIENT_AUTH`, `REUSABLE_AUTH_CODE` |
| Token Validation | 9 | `ACCEPT_NONE_ALGORITHM`, `SKIP_JWT_VERIFICATION`, `FLEXIBLE_JWT_ALGORITHM` |
| Token Storage | 3 | `LOCALSTORAGE_TOKENS` |
| Token Transmission | 3 | `ALLOW_TOKEN_IN_URL`, `HTTP_RESOURCE_SERVER` |
| Refresh Token | 3 | `REUSABLE_REFRESH_TOKENS` |
| Flow-Specific | 3 | `IMPLICIT_FLOW`, `PASSWORD_GRANT` |
| Other | 4 | `SKIP_CERT_VALIDATION` |
| **Total** | **39** | - |

---

## 5. Vulnerability Toggle Data Structure

### 5.1 TypeScript Interface

```typescript
interface VulnerabilityConfig {
  // Authorization Endpoint
  DISABLE_PKCE: boolean;
  SKIP_STATE_VALIDATION: boolean;
  PREDICTABLE_STATE: boolean;
  LAX_REDIRECT_URI: boolean;
  PATTERN_MATCHING_URI: boolean;
  ALLOW_IFRAME: boolean;
  HTTP_AUTHORIZATION_ENDPOINT: boolean;
  DISABLE_ISS_CHECK: boolean;
  PKCE_DOWNGRADE: boolean;
  
  // Token Endpoint
  SKIP_CLIENT_AUTH: boolean;
  WEAK_CLIENT_SECRET: boolean;
  REUSABLE_AUTH_CODE: boolean;
  ALLOW_SCOPE_ESCALATION: boolean;
  HTTP_TOKEN_ENDPOINT: boolean;
  
  // Token Validation
  SKIP_JWT_VERIFICATION: boolean;
  ACCEPT_NONE_ALGORITHM: boolean;
  FLEXIBLE_JWT_ALGORITHM: boolean;
  SKIP_EXPIRATION_CHECK: boolean;
  SKIP_AUD_CHECK: boolean;
  SKIP_ISS_CHECK: boolean;
  SKIP_NONCE: boolean;
  SKIP_AT_HASH: boolean;
  SKIP_HASH_VALIDATION: boolean;
  
  // Token Storage
  LOCALSTORAGE_TOKENS: boolean;
  INSECURE_REFRESH_STORAGE: boolean;
  ALLOW_TOKEN_EXPORT: boolean;
  
  // Token Transmission
  ALLOW_TOKEN_IN_URL: boolean;
  HTTP_RESOURCE_SERVER: boolean;
  ALLOW_FRAGMENT_TOKENS: boolean;
  
  // Refresh Token
  REUSABLE_REFRESH_TOKENS: boolean;
  INFINITE_REFRESH_LIFETIME: boolean;
  SKIP_REFRESH_ROTATION: boolean;
  
  // Flow-Specific
  IMPLICIT_FLOW: boolean;
  PASSWORD_GRANT: boolean;
  LOG_CREDENTIALS: boolean;
  
  // Other
  NO_RATE_LIMITING: boolean;
  SKIP_CERT_VALIDATION: boolean;
  CLIENT_OPEN_REDIRECT: boolean;
  VERBOSE_ERROR_MESSAGES: boolean;
}

interface VulnerabilityMetadata {
  name: string;
  category: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  attack: string;
  specReference: string[];
  relatedDocs: string[];
  description: string;
  impact: string;
  mitigation: string;
}

interface VulnerabilityMode {
  enabled: boolean;
  config: VulnerabilityConfig;
  metadata: Map<keyof VulnerabilityConfig, VulnerabilityMetadata>;
}
```

### 5.2 Default Configuration (Secure)

```javascript
const SECURE_DEFAULTS: VulnerabilityConfig = {
  // All toggles false = secure
  DISABLE_PKCE: false,
  SKIP_STATE_VALIDATION: false,
  PREDICTABLE_STATE: false,
  // ... all other toggles false
};
```

### 5.3 Configuration Storage

**In-Memory Only** (recommended):
```javascript
// Do NOT persist vulnerable state
let vulnerabilityConfig = { ...SECURE_DEFAULTS };

// Reset on page reload
window.addEventListener('beforeunload', () => {
  vulnerabilityConfig = { ...SECURE_DEFAULTS };
});
```

**Session Storage** (if persistence needed for demo):
```javascript
// Only persist during session, not across browser closes
sessionStorage.setItem('vulnConfig', JSON.stringify(vulnerabilityConfig));
```

**DO NOT use localStorage** - vulnerable configurations should not persist

---

## 6. UI/UX Requirements

### 6.1 Vulnerability Mode Toggle Panel

**Component Structure**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vulnerability Mode                        [ON] [OFF]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  âš ï¸  WARNING: Educational demonstrations only           â”‚
â”‚  Security protections intentionally disabled             â”‚
â”‚                                                          â”‚
â”‚  Select vulnerabilities to demonstrate:                 â”‚
â”‚                                                          â”‚
â”‚  â–¼ Authorization Endpoint (2/9 enabled)                 â”‚
â”‚    [âœ“] DISABLE_PKCE                    ğŸ”´ Critical      â”‚
â”‚       Code interception attack                          â”‚
â”‚       [Learn More] [Demonstrate Attack]                 â”‚
â”‚                                                          â”‚
â”‚    [ ] SKIP_STATE_VALIDATION           ğŸ”´ Critical      â”‚
â”‚       CSRF attack                                       â”‚
â”‚       [Learn More] [Demonstrate Attack]                 â”‚
â”‚                                                          â”‚
â”‚    [âœ“] LAX_REDIRECT_URI                ğŸ”´ Critical      â”‚
â”‚       Open redirect attack                              â”‚
â”‚       [Learn More] [Demonstrate Attack]                 â”‚
â”‚                                                          â”‚
â”‚    ... (collapsed toggles)                              â”‚
â”‚                                                          â”‚
â”‚  â–¶ Token Validation (0/9 enabled)                       â”‚
â”‚  â–¶ Token Storage (0/3 enabled)                          â”‚
â”‚  â–¶ Flow-Specific (0/3 enabled)                          â”‚
â”‚                                                          â”‚
â”‚  Quick Actions:                                         â”‚
â”‚  [Enable All Critical] [Disable All] [Reset to Secure] â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Global Warning Banner

**Always Visible When Vulnerabilities Active**:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  VULNERABILITY MODE: 3 VULNERABILITIES ACTIVE  âš ï¸     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  â€¢ DISABLE_PKCE (Authorization code interception)        â•‘
â•‘  â€¢ LAX_REDIRECT_URI (Open redirect attack)               â•‘
â•‘  â€¢ SKIP_JWT_VERIFICATION (Token forgery)                 â•‘
â•‘                                                           â•‘
â•‘  [View Details] [Reset to Secure Mode]                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 6.3 Per-Toggle Information Card

**Expandable Details for Each Vulnerability**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âœ“] DISABLE_PKCE                                       â”‚
â”‚      Code Interception Attack                  ğŸ”´ CRITICAL â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  What This Does:                                        â”‚
â”‚  Removes Proof Key for Code Exchange (PKCE) protection â”‚
â”‚  from authorization code flow, allowing intercepted     â”‚
â”‚  codes to be exchanged without verification.            â”‚
â”‚                                                          â”‚
â”‚  Attack Scenario:                                       â”‚
â”‚  1. Attacker intercepts authorization code             â”‚
â”‚  2. Without PKCE, attacker exchanges code for tokens   â”‚
â”‚  3. Attacker gains access to victim's account          â”‚
â”‚                                                          â”‚
â”‚  Educational Value:                                     â”‚
â”‚  Demonstrates why PKCE is critical for public clients  â”‚
â”‚  and recommended for confidential clients.              â”‚
â”‚                                                          â”‚
â”‚  [Demonstrate Attack] [View Mitigation] [Learn More]   â”‚
â”‚                                                          â”‚
â”‚  Spec References: RFC 7636, Security BCP Â§4.8           â”‚
â”‚  Related Docs: pkce-implementation.md                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 Attack Demonstration Workflow

**Interactive Attack Simulation**:

```
Step 1/5: Authorization Request
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User initiates login with spa-client                   â”‚
â”‚  PKCE: âŒ DISABLED (vulnerability active)               â”‚
â”‚                                                          â”‚
â”‚  Authorization URL:                                     â”‚
â”‚  /auth?response_type=code&client_id=spa-client          â”‚
â”‚       &redirect_uri=...&state=xyz                       â”‚
â”‚                                                          â”‚
â”‚  âš ï¸ Notice: No code_challenge parameter                 â”‚
â”‚                                                          â”‚
â”‚  [Continue to Next Step]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2/5: Code Interception
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Authorization code issued:                             â”‚
â”‚  code=SplxlOBeZQQYbYS6WxSbIA                            â”‚
â”‚                                                          â”‚
â”‚  ğŸ­ SIMULATED ATTACKER intercepts code                  â”‚
â”‚  (via network sniffing, malware, URI hijacking)         â”‚
â”‚                                                          â”‚
â”‚  Attacker now has: SplxlOBeZQQYbYS6WxSbIA               â”‚
â”‚                                                          â”‚
â”‚  [Show Interception Methods] [Continue]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3/5: Attacker Token Exchange
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ­ ATTACKER attempts to exchange code:                 â”‚
â”‚                                                          â”‚
â”‚  POST /token                                            â”‚
â”‚  grant_type=authorization_code                          â”‚
â”‚  code=SplxlOBeZQQYbYS6WxSbIA                           â”‚
â”‚  client_id=spa-client                                   â”‚
â”‚  redirect_uri=...                                       â”‚
â”‚                                                          â”‚
â”‚  âš ï¸ No code_verifier required (PKCE disabled)           â”‚
â”‚                                                          â”‚
â”‚  Response: âœ… SUCCESS                                    â”‚
â”‚  {                                                       â”‚
â”‚    "access_token": "eyJhbGc...",                        â”‚
â”‚    "token_type": "Bearer",                              â”‚
â”‚    "expires_in": 3600                                   â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  ğŸš¨ ATTACK SUCCEEDED - Attacker has victim's tokens     â”‚
â”‚                                                          â”‚
â”‚  [Continue to Mitigation]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4/5: With PKCE Protection
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Now let's see the same attack WITH PKCE:               â”‚
â”‚                                                          â”‚
â”‚  Authorization includes:                                â”‚
â”‚  code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWb...    â”‚
â”‚  code_challenge_method=S256                             â”‚
â”‚                                                          â”‚
â”‚  ğŸ­ ATTACKER intercepts same code                       â”‚
â”‚                                                          â”‚
â”‚  ATTACKER attempts exchange WITHOUT code_verifier:      â”‚
â”‚  Response: âŒ ERROR                                      â”‚
â”‚  {                                                       â”‚
â”‚    "error": "invalid_grant",                            â”‚
â”‚    "error_description": "PKCE verification failed"      â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  ğŸ›¡ï¸ ATTACK BLOCKED - PKCE prevents code use             â”‚
â”‚                                                          â”‚
â”‚  [Continue to Summary]                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 5/5: Lesson Summary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KEY TAKEAWAYS                                          â”‚
â”‚                                                          â”‚
â”‚  Without PKCE:                                          â”‚
â”‚  âŒ Authorization codes can be stolen and used          â”‚
â”‚  âŒ Attacker gains full account access                  â”‚
â”‚  âŒ No way to detect the attack                         â”‚
â”‚                                                          â”‚
â”‚  With PKCE:                                             â”‚
â”‚  âœ… Codes are bound to original requestor               â”‚
â”‚  âœ… Stolen codes are useless to attacker                â”‚
â”‚  âœ… OAuth 2.1 REQUIRES PKCE for all clients             â”‚
â”‚                                                          â”‚
â”‚  MITIGATION:                                            â”‚
â”‚  â€¢ Always use PKCE (S256 method)                        â”‚
â”‚  â€¢ Generate high-entropy code_verifier                  â”‚
â”‚  â€¢ Store verifier securely until token exchange         â”‚
â”‚                                                          â”‚
â”‚  [View Implementation Guide] [Try Another Vulnerability] â”‚
â”‚  [Reset to Secure Mode]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 Security Checklist

**Before Leaving Vulnerability Mode**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECURITY CHECKLIST                                     â”‚
â”‚  Ensure these are configured before production:         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â˜ All vulnerability toggles DISABLED                   â”‚
â”‚  â˜ PKCE enabled with S256 method                        â”‚
â”‚  â˜ State parameter validation enabled                   â”‚
â”‚  â˜ Exact redirect URI matching                          â”‚
â”‚  â˜ JWT signature verification active                    â”‚
â”‚  â˜ Token expiration checks enabled                      â”‚
â”‚  â˜ Secure token storage (not localStorage)             â”‚
â”‚  â˜ HTTPS enforced for all endpoints                     â”‚
â”‚  â˜ Client secret is strong (32+ characters)            â”‚
â”‚  â˜ No deprecated flows (implicit, password grant)      â”‚
â”‚                                                          â”‚
â”‚  [âœ“] I confirm all security controls are enabled        â”‚
â”‚  [Export Secure Configuration]                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Vulnerability Difficulty Levels

### 7.1 Beginner Level (Start Here)

**Purpose**: Understand fundamental OAuth2 security concepts

| Toggle | Attack | Why Start Here |
|--------|--------|----------------|
| `DISABLE_PKCE` | Code Interception | Core OAuth 2.1 requirement, clear attack scenario |
| `SKIP_STATE_VALIDATION` | CSRF | Classic web security vulnerability, easy to understand |
| `LOCALSTORAGE_TOKENS` | XSS Token Theft | Common implementation mistake |
| `ALLOW_TOKEN_IN_URL` | URL Token Leakage | Obvious security issue, clear mitigation |

**Learning Path**: 
1. Start with `DISABLE_PKCE` - understand code binding
2. Move to `SKIP_STATE_VALIDATION` - learn CSRF protection
3. Try `LOCALSTORAGE_TOKENS` - understand storage security
4. Finish with `ALLOW_TOKEN_IN_URL` - learn transport security

### 7.2 Intermediate Level

**Purpose**: Understand protocol-level vulnerabilities

| Toggle | Attack | Prerequisites |
|--------|--------|---------------|
| `LAX_REDIRECT_URI` | Open Redirect | Understand redirect_uri purpose |
| `SKIP_AT_HASH` | Access Token Injection | Understand ID tokens and claims |
| `REUSABLE_REFRESH_TOKENS` | Token Replay | Understand refresh token flow |
| `SKIP_EXPIRATION_CHECK` | Expired Token Use | Understand JWT claims |
| `PATTERN_MATCHING_URI` | URI Validation Bypass | Understand URL matching |

### 7.3 Advanced Level

**Purpose**: Understand complex attack chains and edge cases

| Toggle | Attack | Prerequisites |
|--------|--------|---------------|
| `ACCEPT_NONE_ALGORITHM` | alg=none Bypass | Understand JWT structure |
| `FLEXIBLE_JWT_ALGORITHM` | Algorithm Confusion | Understand cryptographic algorithms |
| `DISABLE_ISS_CHECK` | Mix-Up Attack | Understand multi-IdP scenarios |
| `PKCE_DOWNGRADE` | PKCE Downgrade | Understand PKCE thoroughly |
| `ALLOW_SCOPE_ESCALATION` | Privilege Escalation | Understand OAuth scopes |

### 7.4 Expert Level (Combinations)

**Purpose**: Understand how vulnerabilities compound

**Example Chains**:

1. **Complete Account Takeover Chain**:
   - `HTTP_AUTHORIZATION_ENDPOINT` (network interception possible)
   - `DISABLE_PKCE` (intercepted code usable)
   - `SKIP_CLIENT_AUTH` (no client verification)
   - Result: Full account compromise

2. **Phishing Attack Chain**:
   - `SKIP_STATE_VALIDATION` (CSRF possible)
   - `LAX_REDIRECT_URI` (code redirect to attacker)
   - Result: Authorization code phishing

3. **Token Forgery Chain**:
   - `ACCEPT_NONE_ALGORITHM` (no signature required)
   - `SKIP_AUD_CHECK` (token usable anywhere)
   - `SKIP_EXPIRATION_CHECK` (token never expires)
   - Result: Unlimited forged tokens

---

## 8. Compliance and Terms of Use

### 8.1 Terms of Use

**Acceptance Required Before Enabling Vulnerability Mode**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VULNERABILITY MODE - TERMS OF USE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  By enabling Vulnerability Mode, you agree to:          â”‚
â”‚                                                          â”‚
â”‚  1. Use this feature for EDUCATIONAL PURPOSES ONLY      â”‚
â”‚                                                          â”‚
â”‚  2. NOT use these techniques against systems you do     â”‚
â”‚     not own or have explicit written permission to test â”‚
â”‚                                                          â”‚
â”‚  3. Understand that unauthorized testing may violate:   â”‚
â”‚     â€¢ Computer Fraud and Abuse Act (U.S.)              â”‚
â”‚     â€¢ Computer Misuse Act (U.K.)                        â”‚
â”‚     â€¢ Similar laws in your jurisdiction                 â”‚
â”‚                                                          â”‚
â”‚  4. Take responsibility for your use of this software   â”‚
â”‚                                                          â”‚
â”‚  5. NOT hold the authors liable for misuse              â”‚
â”‚                                                          â”‚
â”‚  Acceptable Use:                                        â”‚
â”‚  âœ“ Learning OAuth2/OIDC security                        â”‚
â”‚  âœ“ Testing your own applications                        â”‚
â”‚  âœ“ Authorized security assessments                      â”‚
â”‚  âœ“ Educational demonstrations                           â”‚
â”‚                                                          â”‚
â”‚  [ ] I have read and agree to these terms               â”‚
â”‚                                                          â”‚
â”‚  [Accept and Continue] [Cancel]                         â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Data Privacy

**No Real User Data in Demonstrations**:
- All demonstrations use test accounts (alice, bob, admin)
- No PII in educational content
- Localhost-only demonstrations
- No external data transmission

### 8.3 Attribution

**Proper Attribution to Specifications**:
- All vulnerability demonstrations cite relevant RFCs/BCPs
- Links to original specification documents
- Credit to OAuth/OIDC working groups
- Educational fair use

---

## Document Metadata

| Property | Value |
|----------|-------|
| **Version** | 1.0.0 |
| **Part** | 1 of 4 (Overview) |
| **Related Docs** | `vulnerability-mode-authorization.md`, `vulnerability-mode-token.md`, `vulnerability-mode-implementation.md` |
| **Target** | Claude Code (implementation) |

---

**Next**: See `vulnerability-mode-authorization.md` for detailed specifications of authorization endpoint vulnerabilities.
