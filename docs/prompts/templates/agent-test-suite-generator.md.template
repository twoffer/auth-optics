@agent-test-suite-generator

## Task: Test the implementation of {{component_name}}

**Detailed Plan:** {{detailed_plan}}
**GitHub PR:** {{github_pr}}
**Git Branch:** {{git_branch}}

### Requirements
- Validate the implementation in GitHub PR {{github_pr}} (branch {{git_branch}}) according to:
  * The Test Plan in the PR
  * The verification checklist in {{detailed_plan}}
  * Any other criteria relevant to these changes
- **Test Execution:** Run all relevant tests (both existing and newly written)
- **Test Code:** Write new automated test code when needed (see Test Scope Guidance below)
- Always use the reference specification documents and the official OAuth2/OIDC RFCs/specs to determine what the expected behavior should be

### Context Loading (See @docs/context/agent-coordination.md)
**Always Load:**
- Detailed implementation plan: {{detailed_plan}}
- Component specification: {{specification}}
- GitHub PR diff (if available): {{github_pr}}

{{#if requires_oauth_context}}
**OAuth2/OIDC Context:**
- START HERE: @docs/reference/00-NAVIGATION-START-HERE.md (master index)
- Use the navigation guide to find expected behavior specifications
- Focus on validation requirements for the component being tested

{{/if}}
{{#if security_critical}}
**Security-Critical Context:**
- @docs/reference/security/oauth2-oidc-threat-model-INDEX.md
- Use to understand which attacks should be prevented by this component

{{/if}}
**DO NOT Load:**
- Implementation plans (only use verification checklists)
- Entire @docs/reference/ directory at once

### Test Scope Guidance

**When to Write New Test Code:**

You SHOULD write automated test code when the component includes:
- ‚úì Business logic or algorithms (e.g., PKCE generation, token validation)
- ‚úì Security-critical functionality (e.g., authentication, authorization, cryptography)
- ‚úì External integrations (e.g., KeyCloak API calls, HTTP requests)
- ‚úì Complex state management or data transformations
- ‚úì API endpoints with request/response handling

**When Test Code is NOT Required:**

You may skip writing new test code for:
- Pure TypeScript type definitions (interfaces, types, enums)
- Configuration files without logic (JSON, YAML)
- Documentation-only changes (markdown files)
- Simple utility functions with obvious behavior

**Test Types to Consider:**

Choose the appropriate test type(s) based on what you're testing:
- **Unit Tests:** Test individual functions/services in isolation
  - Example: Testing PKCE code_verifier generation function
  - Location: `packages/[component]/__tests__/unit/`
- **Integration Tests:** Test interactions between components
  - Example: Testing OAuth2Client service calling KeyCloak discovery endpoint
  - Location: `packages/[component]/__tests__/integration/`
- **End-to-End Tests:** Test complete user workflows across the system
  - Example: Full authorization code flow from frontend through backend to KeyCloak
  - Location: `packages/[component]/__tests__/e2e/`

**Test Framework Setup:**
- **Use vitest** for all automated testing (required)
- If vitest is not configured for the package, set it up:
  1. Add to `package.json`: `vitest`, `@vitest/ui`, `@vitest/coverage-v8`
  2. Create `vitest.config.ts` with TypeScript support
  3. Add test scripts: `"test": "vitest"`, `"test:coverage": "vitest --coverage"`
- Reference existing vitest configs in other packages for consistency

**Test Implementation Guidelines:**
- Follow existing testing patterns in the codebase
- Write tests using vitest (`describe`, `it`, `expect`) in TypeScript
- Write tests in the appropriate `__tests__/` directory for the component
- Ensure tests are deterministic and don't depend on external state
- Include both happy path and error case scenarios
- Mock external dependencies appropriately for unit tests

### Scope Guards (See @docs/context/agent-coordination.md for details)
**DO:**
- Validate implementation against specification requirements
- Write test code for components with logic (per Test Scope Guidance above)
- Run all relevant tests (existing and newly written)
- Document test failures in pending-issues.md
- Verify security properties against the threat model

**DO NOT:**
- Fix implementation code (report issues only - fixes are handled by other agents)
- Modify production code (testing only)
- Change test requirements (follow the specification and verification checklist)

### Documentation Requirements
- Write test results to {{output_report}}
- Create the test results document according to the guidelines in @docs/test-reports/README.md

### Project Tracking Requirements (See @docs/context/agent-coordination.md for ownership)

**Update @docs/context/pending-issues.md (if applicable):**
- [ ] Add any issues discovered during testing
- [ ] Categorize by priority (Critical/High/Medium/Low)
- [ ] Include file paths to failing test code if applicable
- [ ] Include line numbers of failing code if known

### Exit Criteria
- [ ] All test validations executed
      ‚úì All verification checklist items tested
      ‚úì Test code written (if applicable)
      ‚úì All tests run successfully (or failures documented)
- [ ] Any issues documented
      ‚úì Test failures added to pending-issues.md
      ‚úì Issues categorized by priority
- [ ] All documents updated
      ‚úì Test report exists at {{output_report}}
- [ ] All project tracking updated
      ‚úì pending-issues.md updated (if failures)
- [ ] Ready for next phase
      ‚úì Test report complete
      ‚úì No critical test failures blocking merge

### Completion Signal (Output when done)
```markdown
---
‚úÖ AGENT COMPLETE: test-suite-generator

üìÅ Artifacts Created:
   - {{output_report}}
   - Test code in packages/{{component_type}}/__tests__/ (if applicable)

üìã Context Updates:
   - pending-issues.md (added [Count of issues] issues) [if failures]

üéØ Ready For: code-security-reviewer (or User Review if reviewer already ran)

‚ö†Ô∏è Blockers for Next Agent: [None / List specific blockers]

üìù Notes:
   - Test Results: [Test pass count] passed, [Test fail count] failed
   - [Key findings]
---
```

### References
- **Coordination guide:** @docs/context/agent-coordination.md (read first!)
- **Detailed plan:** {{detailed_plan}}
- **Component specification:** {{specification}}
- **Architecture:** @docs/specs/auth-optics-architecture.md
- **OAuth2/OIDC reference:** @docs/reference/ (load selectively per context rules)
- **Project roadmap:** @ROADMAP.md
- **Current context:** @docs/context/current-phase.md
- **GitHub PR:** {{github_pr}}
- **Related GitHub Issue:** {{github_issue}}
