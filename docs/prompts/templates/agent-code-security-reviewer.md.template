@agent-code-security-reviewer

## Task: Review the implementation of {{component_name}}

### Requirements
- Review the functionality in GitHub PR {{github_pr}} (git branch {{git_branch}}) and evaluate whether it satisfies the following:
  - The design in {{specification}}
  - The specific implementation plan in {{detailed_plan}}
  - OAuth2/OIDC standards according to the reference specification documentation
  - Standards and best practices for TypeScript, React, Node.js, Vite, Tailwind CSS, Radix UI, and any other technologies used
- Always use the reference specification documents and the official OAuth2/OIDC RFCs/specs to determine what the expected behavior should be

### Context Loading (See @docs/context/agent-coordination.md)
**Always Load:**
- Component specification: {{specification}}
- Detailed implementation plan: {{detailed_plan}}
- GitHub PR diff (if available): {{github_pr}}
- @docs/reference/security/security-best-current-practice.md (all parts)

{{#if requires_oauth_context}}
**OAuth2/OIDC Context:**
- START HERE: @docs/reference/00-NAVIGATION-START-HERE.md (master index)
- Use the navigation guide to find relevant security/flow/token documents
- Focus on security requirements for the specific component

{{/if}}
{{#if requires_keycloak_context}}
**KeyCloak Security Context:**
- @docs/reference/keycloak/keycloak-security-and-vulnerability-mode.md

{{/if}}
{{#if security_critical}}
**Security-Critical Context:**
- CRITICAL: @docs/reference/security/oauth2-oidc-threat-model-INDEX.md (start here)
- Use the comprehensive index to find ALL relevant attack scenarios
- Review attack chains and mitigations for the component's functionality

{{/if}}
**DO NOT Load:**
- Test reports
- Other components' reviews
- Entire @docs/reference/ directory at once

### Scope Guards (See @docs/context/agent-coordination.md for details)
**DO:**
- Identify security vulnerabilities
- Check OAuth2/OIDC RFC compliance
- Suggest improvements
- Flag deviations from specifications

**DO NOT:**
- Fix code directly (suggest fixes in review)
- Modify specifications (flag discrepancies)
- Approve/reject PRs (user decision)
- Implement suggestions (reviewer role only)

### Documentation Requirements
- Write the review results to {{output_review}}
  - Use the guidelines in @docs/reviews/README.md
- Add a review summary to PR {{github_pr}}
  - Add one top-level comment summarizing the review and linking to the detailed review document
  - All specific issues, code references, and recommendations are documented in the review file

### Verification Requirements
- The code in GitHub PR {{github_pr}}, if it included all suggested fixes and improvements, would meet or exceed OAuth2/OIDC, security, and coding standards

### Project Tracking Requirements (See @docs/context/agent-coordination.md for ownership)

**Update @docs/context/current-phase.md:**
- [ ] Update "Current Phase" section with short paragraph summarizing the review that was completed
- [ ] Update "Next Steps" with "Address review issues" or "Ready for merge"
- [ ] Update "Last Updated" timestamp
- [ ] Add links to review report

**Update @docs/context/pending-issues.md (if issues found):**
- [ ] Add ALL issues discovered during the review, regardless of priority (PRIMARY OWNER for review issues)
- [ ] Include Critical, High, Medium, AND Low priority issues
- [ ] Place each issue in the appropriate priority section:
  - Critical issues ‚Üí "Critical Issues (Block Progress)"
  - High priority ‚Üí "High Priority"
  - Medium priority ‚Üí "Medium Priority"
  - Low priority ‚Üí "Low Priority / Nice to Have"
- [ ] Include file paths where issues were found
- [ ] Link to review document for details

### Exit Criteria
- [ ] All code in the PR reviewed
      ‚úì All files in PR examined
      ‚úì All modified lines checked against specs
      ‚úì Security implications assessed
- [ ] All issues identified
      ‚úì Security vulnerabilities documented
      ‚úì RFC compliance issues noted
      ‚úì Code quality issues listed
      ‚úì Suggestions for improvement provided
- [ ] All documentation created
      ‚úì Review report exists at {{output_review}}
      ‚úì Issues categorized by severity
      ‚úì Recommendations actionable
      ‚úì Review summary comment added to PR {{github_pr}}
- [ ] All project tracking updated
      ‚úì current-phase.md updated
      ‚úì pending-issues.md updated (if issues found)
- [ ] Ready for next phase
      ‚úì Review complete
      ‚úì User can make decision to merge or address issues

### Completion Signal (Output when done)
```markdown
---
‚úÖ AGENT COMPLETE: code-security-reviewer

üìÅ Artifacts Created:
   - {{output_review}}

üìã Context Updates:
   - current-phase.md (updated: Current Phase, Next Steps)
   - pending-issues.md (added [count of issues] issues) [if issues found]

üéØ Ready For: User Review (merge decision)

‚ö†Ô∏è Blockers for Merge: [Count of critical issues, if any] Critical, [Count of high priority issues, if any] High priority issues

üìù Notes:
   - Overall Assessment: [Approve/Approve with minor fixes/Major revisions needed]
   - Security Status: [Secure/Issues found/Critical vulnerabilities]
   - RFC Compliance: [Compliant/Deviations noted]
---
```

### References
- **Coordination guide:** @docs/context/agent-coordination.md (read first!)
- **Component specification:** {{specification}}
- **Detailed plan:** {{detailed_plan}}
- **Security BCP (always load):** @docs/reference/security/security-best-current-practice.md
- **Architecture:** @docs/specs/auth-optics-architecture.md
- **OAuth2/OIDC reference:** @docs/reference/ (load selectively per context rules)
- **Project roadmap:** @ROADMAP.md
- **Current context:** @docs/context/current-phase.md
- **GitHub PR:** {{github_pr}}
- **Related GitHub Issue:** {{github_issue}}
